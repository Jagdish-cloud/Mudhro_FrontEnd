# Mudhro Backend API

Professional backend API for Mudhro FinTech application, providing user registration and authentication services.

## Features

- ✅ User registration with validation
- ✅ User authentication with JWT tokens
- ✅ Password hashing with bcrypt
- ✅ Refresh token support
- ✅ PostgreSQL database integration
- ✅ TypeScript for type safety
- ✅ Express.js RESTful API
- ✅ Comprehensive error handling
- ✅ Request validation
- ✅ CORS configuration
- ✅ Database connection pooling

## Prerequisites

- Node.js (v18 or higher)
- PostgreSQL (v12 or higher)
- npm or yarn

## Installation

1. Install dependencies:
```bash
npm install
```

2. Set up environment variables:
```bash
cp .env.example .env
```

Edit `.env` with your database credentials:
```
DB_HOST=localhost
DB_PORT=5432
DB_NAME=Mudhro_FinTech
DB_USER=postgres
DB_PASSWORD=root

JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=2h
REFRESH_TOKEN_EXPIRES_IN=7d

PORT=3000
NODE_ENV=development
CORS_ORIGIN=http://localhost:8080
```

3. Set up the database:
   - Create the database `Mudhro_FinTech` in PostgreSQL
   - Run the SQL schema from `src/config/db-schema.sql` to create the users table

## Running the Server

### Development
```bash
npm run dev
```

### Production
```bash
npm run build
npm start
```

## API Endpoints

### Health Check
```
GET /health
```

### User Registration
```
POST /api/auth/register
Content-Type: application/json

{
  "fullName": "John Doe",
  "email": "john@example.com",
  "password": "password123",
  "country": "India",
  "mobileNumber": "+91-9876543210",
  "planId": "PLAN-PRO-001",
  "gstin": "27AAEPM1234C1Z1",
  "pan": "AAEPM1234C"
}
```

**Note:** The `id` field is auto-generated by the database and should not be included in the request body.

### User Login
```
POST /api/auth/login
Content-Type: application/json

{
  "email": "john@example.com",
  "password": "password123"
}
```

Response:
```json
{
  "success": true,
  "message": "Login successful",
  "user": { ... },
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "jwtIssuedAt": "2025-11-02T10:15:30Z",
  "jwtExpiresAt": "2025-11-02T12:15:30Z"
}
```

### Get User Profile (Protected)
```
GET /api/user/profile
Authorization: Bearer <access_token>
```

## Project Structure

```
backend/
├── src/
│   ├── config/          # Database configuration and schema
│   ├── middleware/      # Auth, error handling, validation
│   ├── routes/          # API route handlers
│   ├── services/        # Business logic
│   ├── types/           # TypeScript type definitions
│   ├── utils/           # Utility functions (JWT, password hashing)
│   └── index.ts         # Application entry point
├── dist/                # Compiled JavaScript (generated)
├── package.json
├── tsconfig.json
└── README.md
```

## Security Features

- Password hashing using bcrypt (10 salt rounds)
- JWT tokens for authentication
- Refresh tokens for session management
- Input validation and sanitization
- SQL injection protection (using parameterized queries)
- CORS configuration
- Environment variables for sensitive data

## Notes

- The sample data structure provided in the requirements is for reference only
- Passwords are automatically hashed before storing
- User IDs are auto-generated as integers using PostgreSQL SERIAL
- The `id` field should not be provided in registration requests - it's automatically assigned by the database
- The `updatedAt` field is automatically updated via database trigger
- All timestamps are stored in UTC

## Development

### Type Checking
```bash
npm run type-check
```

### Linting
```bash
npm run lint
```

## License

ISC

